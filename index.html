// ===================== CONFIG =====================
const mythicRewards = [
  { img: "rewards/mythic1.png", name: "Excalibur", rarity: "MYTHIC" },
  { img: "rewards/mythic2.png", name: "Phoenix Flame", rarity: "MYTHIC" },
  { img: "rewards/mythic3.png", name: "Dragon Orb", rarity: "MYTHIC" },
  { img: "rewards/mythic4.png", name: "Celestial Crown", rarity: "MYTHIC" }
];

// √Çm thanh
const tickSound = new Audio("sounds/tick.mp3");
const winSound = new Audio("sounds/win.mp3");
let soundEnabled = true; // toggle tr·∫°ng th√°i √¢m thanh

// N√∫t b·∫≠t/t·∫Øt √¢m thanh (b·∫°n c√≥ th·ªÉ ƒë·∫∑t trong HTML ch√≠nh)
const soundBtn = document.createElement("button");
soundBtn.textContent = "üîä √Çm thanh: B·∫¨T";
soundBtn.style.position = "fixed";
soundBtn.style.top = "10px";
soundBtn.style.right = "10px";
soundBtn.style.zIndex = "10000";
soundBtn.onclick = () => {
  soundEnabled = !soundEnabled;
  soundBtn.textContent = soundEnabled ? "üîä √Çm thanh: B·∫¨T" : "üîá √Çm thanh: T·∫ÆT";
};
document.body.appendChild(soundBtn);

// ===================== H√ÄM SHOW REWARD =====================
function showReward_MythicGuaranteed() {
  // ch·ªçn random 1 ph·∫ßn th∆∞·ªüng Mythic
  const finalReward = mythicRewards[Math.floor(Math.random() * mythicRewards.length)];

  const itemCount = 20;
  const itemWidth = 100;
  const gap = 10;
  const frameWidth = 600;
  const targetIndex = 14;

  const overlay = document.createElement("div");
  overlay.style.cssText = `
    position:fixed; top:0; left:0; width:100%; height:100%;
    background:rgba(0,0,0,0.95); display:flex; align-items:center; justify-content:center;
    z-index:9999; overflow:hidden;
  `;

  const frame = document.createElement("div");
  frame.style.cssText = `
    width:${frameWidth}px; height:${itemWidth + 40}px; overflow:hidden;
    border-radius:12px; border:4px solid gold; background:#111;
    position:relative; display:flex; align-items:center;
  `;

  const carousel = document.createElement("div");
  carousel.style.cssText = `display:flex; gap:${gap}px; transform:translateX(0); will-change:transform;`;

  // T·∫°o 20 item, t·∫°i targetIndex = finalReward
  for (let i = 0; i < itemCount; i++) {
    const card = document.createElement("div");
    card.style.cssText = `
      width:${itemWidth}px; height:${itemWidth}px; border-radius:8px;
      overflow:hidden; flex-shrink:0; background:#333;
    `;
    const img = document.createElement("img");
    img.style.cssText = `width:100%; height:100%; object-fit:cover;`;
    img.src = (i === targetIndex) ? finalReward.img : mythicRewards[Math.floor(Math.random() * mythicRewards.length)].img;
    card.appendChild(img);
    carousel.appendChild(card);
  }

  frame.appendChild(carousel);
  overlay.appendChild(frame);

  // V·∫°ch ch·ªâ gi·ªØa
  const marker = document.createElement("div");
  marker.style.cssText = `
    position:absolute; top:0; left:50%; transform:translateX(-50%);
    width:${itemWidth + 8}px; height:${itemWidth + 8}px; border:2px solid white;
    border-radius:10px; pointer-events:none;
  `;
  frame.appendChild(marker);

  document.body.appendChild(overlay);

  // T√≠nh to√°n v·ªã tr√≠ d·ªãch
  const pos = targetIndex * (itemWidth + gap);
  const centerOffset = frameWidth / 2 - itemWidth / 2;
  const translateX = pos - centerOffset;

  // B·∫≠t √¢m tick
  if (soundEnabled) {
    tickSound.loop = true;
    tickSound.currentTime = 0;
    tickSound.play().catch(() => {});
  }

  // Animate
  requestAnimationFrame(() => {
    const duration = 4;
    carousel.style.transition = `transform ${duration}s cubic-bezier(.17,.67,.83,.67)`;
    carousel.style.transform = `translate3d(-${translateX}px, 0, 0)`;
  });

  // Khi k·∫øt th√∫c animation
  const finish = () => {
    carousel.removeEventListener("transitionend", finish);
    if (soundEnabled) tickSound.pause();
    if (soundEnabled) { winSound.currentTime = 0; winSound.play().catch(() => {}); }

    overlay.innerHTML = "";
    const title = document.createElement("h2");
    title.textContent = `‚ú® ${finalReward.rarity} ‚ú®`;
    title.style.cssText = "color:violet; font-size:2rem; text-shadow:0 0 15px magenta;";
    const img = document.createElement("img");
    img.src = finalReward.img;
    img.style.cssText = "width:250px; border:5px solid violet; border-radius:12px; margin-top:20px; box-shadow:0 0 25px violet;";
    const name = document.createElement("p");
    name.textContent = finalReward.name;
    name.style.cssText = "color:white; font-size:1.2rem; margin-top:10px; font-weight:bold;";
    const btn = document.createElement("button");
    btn.textContent = "ƒê√≥ng";
    btn.style.cssText = "margin-top:20px; padding:10px 20px; border-radius:8px; background:violet; color:white; border:none; cursor:pointer;";
    btn.onclick = () => overlay.remove();

    overlay.appendChild(title);
    overlay.appendChild(img);
    overlay.appendChild(name);
    overlay.appendChild(btn);
  };

  carousel.addEventListener("transitionend", finish);
  setTimeout(finish, 5000); // fallback
}
